# 문제 템플릿 작성 규칙

작성일: 2026-02-03
버전: v1.0

이 문서는 `/public/data/templates/*.json` 템플릿 작성 시 반드시 지켜야 할 규칙을 정리합니다.

---

## 1. 핵심 원칙

### 1.1 정답은 반드시 하나

객관식 4개 보기 중 **정확히 1개만 정답**이어야 합니다.
파라미터가 어떤 값이든(범위 내 모든 조합) 이 조건이 깨지면 안 됩니다.

### 1.2 보기 중복 금지

4개 보기의 값이 **모두 달라야** 합니다.
파라미터가 어떤 값이든(범위 내 모든 조합) 중복이 발생하면 안 됩니다.

### 1.3 템플릿 표현식은 반드시 평가 가능해야 함

지원되는 표현식만 사용합니다. 지원되지 않는 JavaScript 문법은 `[표현식?]` 으로 노출됩니다.

---

## 2. "~인 것은?" vs "~아닌 것은?" 질문 설계

### 2.1 "~아닌 것은?" 사용 금지 (약수/공약수 유형)

**문제**: "n의 약수가 아닌 것은?" 에서 오답 보기가 모두 n의 약수임을 보장해야 하지만,
임의의 n에 대해 특정 수가 약수인지 템플릿 수준에서 보장할 수 없습니다.

```
❌ 나쁜 예: "15의 약수가 아닌 것은?" → 보기: 1, 16, 15, 18
   → 16과 18 모두 약수가 아님 → 정답 2개
```

**예외**: 배수/공배수의 "아닌 것은?"은 안전합니다.
`n*k`는 항상 n의 배수이므로 오답 보기를 보장할 수 있습니다.

```
✅ 안전: "n의 배수가 아닌 것은?" → 보기: n*3+1(정답), n*2, n*4, n*5
   → n*2, n*4, n*5는 항상 배수 → 정답 1개 보장
```

### 2.2 "~인 것은?" 패턴 (권장)

정답이 **구조적으로 보장**되고, 오답이 **구조적으로 불가능**한 설계:

```
✅ 좋은 예: "n의 약수인 것은?" → 보기: n(정답), n+1, n+2, n+3
   → n은 항상 자기 자신의 약수
   → n+1, n+2, n+3은 n보다 크므로 절대 약수가 될 수 없음
```

---

## 3. 보기 중복 방지 전략

### 3.1 오프셋 기반 보기 (가장 안전)

정답에서 **서로 다른 고정 오프셋**을 더해 보기를 생성합니다.
오프셋이 모두 다르므로 중복이 구조적으로 불가능합니다.

```json
✅ "choices_template": [
  "{{gcd(a, b)}}",        // 정답
  "{{gcd(a, b) + 2}}",    // 정답 + 2
  "{{gcd(a, b) + 5}}",    // 정답 + 5
  "{{gcd(a, b) + 9}}"     // 정답 + 9
]
```

### 3.2 독립 함수 조합 (위험)

서로 다른 함수의 결과를 보기로 사용하면, 특정 파라미터에서 값이 같아질 수 있습니다.

```json
❌ 위험: "choices_template": [
  "{{lcm(a, b)}}",    // a=6, b=6일 때 → 6
  "{{gcd(a, b)}}",    // a=6, b=6일 때 → 6  ← 중복!
  "{{a * b}}",
  "{{a + b}}"
]
```

### 3.3 혼합 시 주의사항

오프셋이 아닌 보기를 섞을 때는 모든 파라미터 조합에서 값이 겹치지 않는지 확인해야 합니다.

| 표현식 조합 | 중복 위험 | 이유 |
|------------|---------|------|
| `lcm(a,b)` vs `gcd(a,b)` | ⚠️ 높음 | a=b일 때 같은 값 |
| `lcm(a,b)` vs `a+b` | ⚠️ 주의 | 특정 값에서 일치 가능 |
| `n` vs `n+k` (k≠0) | ✅ 안전 | 항상 다름 |
| `f(x)` vs `f(x)+k` (k≠0) | ✅ 안전 | 항상 다름 |

---

## 4. 템플릿 표현식 문법

### 4.1 지원되는 표현식

| 유형 | 예시 | 설명 |
|------|------|------|
| 단순 변수 | `{{n}}` | 파라미터 값 |
| 산술 연산 | `{{n + 1}}`, `{{a * b}}` | +, -, *, / |
| 함수 호출 | `{{gcd(a, b)}}` | 등록된 함수 |
| 함수 + 산술 | `{{gcd(a, b) + 2}}` | 함수 결과에 연산 |
| 상수 | `"1"`, `"9"` | 고정 문자열 |

### 4.2 지원되지 않는 표현식

| 유형 | 예시 | 대안 |
|------|------|------|
| 삼항 연산자 | `{{a > b ? a : b}}` | 별도 함수 등록 |
| 비교 연산자 | `{{gcd(a,b) > 2}}` | 사용 불가 |
| 메서드 체인 | `{{divisors(n).length}}` | `{{divisorCount(n)}}` 사용 |
| 중첩 함수 | `{{gcd(lcm(a,b), c)}}` | 사용 불가 |
| 조건부 로직 | if/else | 사용 불가 |

### 4.3 등록된 함수 목록

| 함수 | 인자 | 반환값 | 예시 |
|------|------|--------|------|
| `gcd(a, b)` | 정수 2개 | 최대공약수 | `gcd(12, 8)` → `4` |
| `lcm(a, b)` | 정수 2개 | 최소공배수 | `lcm(4, 6)` → `12` |
| `divisors(n)` | 정수 1개 | 약수 목록 (문자열) | `divisors(12)` → `1, 2, 3, 4, 6, 12` |
| `divisorCount(n)` | 정수 1개 | 약수 개수 | `divisorCount(12)` → `6` |
| `multiples(n, k)` | 정수 2개 | 배수 k개 (문자열) | `multiples(3, 4)` → `3, 6, 9, 12, ...` |
| `commonDivisors(a, b)` | 정수 2개 | 공약수 목록 (문자열) | `commonDivisors(12, 8)` → `1, 2, 4` |

새 함수가 필요하면 `src/lib/math.ts`에 구현 후 `src/lib/problem-generator.ts`의 `evaluateFunction`에 등록합니다.

---

## 5. 수학적 정답 보장 패턴

### 5.1 약수 문제

```
안전 패턴:
- "n의 약수인 것은?" → 정답: n (자기 자신은 항상 약수)
- "n의 약수인 것은?" → 정답: 1 (1은 모든 수의 약수)
- 오답: n+1, n+2, n+3 (n보다 큰 수는 절대 약수 아님)
- "약수의 개수는?" → 정답: divisorCount(n) / 오답: 오프셋 값

위험 패턴:
- "n의 약수가 아닌 것은?" → 오답 3개가 모두 약수임을 보장 불가
```

### 5.2 배수 문제

```
안전 패턴:
- "n의 배수가 아닌 것은?" → 정답: n*k+1 (나머지 1이므로 절대 배수 아님)
- 오답: n*2, n*4, n*5 (n의 배수 보장)
- "n의 k번째 배수는?" → 정답: n*k / 오답: 오프셋 값
```

### 5.3 최대공약수 문제

```
안전 패턴:
- "a와 b의 최대공약수는?" → 정답: gcd(a,b) / 오답: 오프셋 값
- "a와 b의 공약수인 것은?" → 정답: 1 또는 gcd(a,b)
- 오답: a+b, a+b+1, a+b+2 (a+b > max(a,b)이므로 공약수 불가)

위험 패턴:
- "공약수가 아닌 것은?" → 오답이 공약수임을 보장 불가
```

### 5.4 최소공배수 문제

```
안전 패턴:
- "a와 b의 최소공배수는?" → 정답: lcm(a,b) / 오답: 오프셋 값
- "공배수가 아닌 것은?" → 정답: lcm(a,b)+1
- 오답: lcm(a,b), lcm(a,b)*2, lcm(a,b)*3 (배수이므로 항상 공배수)
```

### 5.5 분수 문제 (향후 확장)

```
안전 패턴:
- "a/b를 약분하면?" → 정답: reduce(a,b) / 오답: 오프셋 분수
- "a/b + c/d = ?" → 정답: 계산값 / 오답: 오프셋 값
```

### 5.6 혼합 계산 문제 (향후 확장)

```
안전 패턴:
- "a + b × c = ?" → 정답: 계산값 / 오답: 오프셋 값
- 오답에 "왼쪽부터 계산한 값" 포함 가능 (흔한 실수 유도)
```

---

## 6. 파라미터 범위 설계 원칙

### 6.1 범위는 좁게

파라미터 범위가 넓으면 엣지 케이스가 늘어납니다.

```json
✅ "n": { "min": 6, "max": 20 }    // 좁은 범위
❌ "n": { "min": 1, "max": 100 }   // 넓은 범위 → 엣지 케이스 많음
```

### 6.2 0과 1 피하기

0은 약수/배수 계산에서 예외를 만들고, 1은 문제가 너무 쉬워집니다.

```json
✅ "a": { "min": 2, "max": 12 }
❌ "a": { "min": 0, "max": 12 }
```

### 6.3 동일 파라미터 범위 겹침 허용

a와 b의 범위가 겹쳐서 a=b가 될 수 있습니다.
이 경우에도 보기가 중복되지 않도록 설계해야 합니다.

---

## 7. 세션과 템플릿 변경

템플릿 JSON을 수정해도 **기존 세션에는 반영되지 않습니다.**
세션 생성 시 문제 데이터가 localStorage에 저장되므로,
템플릿 변경 후에는 사용자가 localStorage를 클리어해야 새 문제가 적용됩니다.

---

## 8. 체크리스트: 새 템플릿 작성 시

- [ ] `solver_rule`의 결과가 `choices_template[0]`과 일치하는가?
- [ ] 파라미터 범위 내 **모든** 조합에서 정답이 정확히 1개인가?
- [ ] 파라미터 범위 내 **모든** 조합에서 보기 4개가 모두 다른 값인가?
- [ ] 삼항 연산자(`? :`), 비교 연산자(`>`, `<`), 메서드 체인(`.length`) 미사용?
- [ ] `solution_steps_template`의 모든 표현식이 평가 가능한가?
- [ ] 숫자 입력 문제의 `solver_rule`이 정수/분수 등 예상 형식과 일치하는가?
